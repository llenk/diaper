<div class="row wrapper border-bottom white-bg page-heading">
  <% content_for :title, "Audits - Inventory - #{current_organization.name}" %>
  <div class="col-lg-8">
    <h1>
      Inventory Audit
      <small>for <%= current_organization.name %></small>
    </h1>
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <%= link_to(dashboard_path) do %>
          <i class="fa fa-dashboard"></i> Home
        <% end %>
      </li>
      <li class="breadcrumb-item">
        <%= link_to "All Adjustments", (audits_path) %>
      </li>
      <li class="active breadcrumb-item">
        Audit (<%= @audit.created_at.strftime("%m/%d/%Y")%>)
      </li>
    </ol>
  </div>
</div>

<!-- Main content -->
<div class="row">
  <div class="col-lg-12">
    <div class="wrapper wrapper-content animated fadeInRight">
      <div class="ibox-title">
        <h3>
          Audit (<%= @audit.created_at.strftime("%m/%d/%Y") %>) - <%= @audit.status.titleize %>
        </h3>
      </div>
      <div class="ibox-content">
        <p>
          <strong>Organization:</strong>
          <%= @audit.organization.name %>
        </p>

        <p>
          <strong>Storage location:</strong>
          <%= @audit.storage_location.name %>
        </p>

        <div class="row">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
              <tr>
                <th>Item</th>
                <th>Audit Quantity</th>
                <th>Quantity in Records</th>
              </tr>
              </thead>
              <tbody>
                <% @inventory_items.each do |inventory_item|  %>
                  <% line_item = @audit.line_items.find_by(item: inventory_item.item) %>
                  <tr class="<%= line_item.nil? ? "table-danger" : (line_item.quantity.equal?(inventory_item.quantity) ? "table-success" : "table-primary") %>">
                  <td><%= inventory_item.item.name %></td>
                  <td><%= line_item&.quantity&.abs || "Not Audited" %></td>
                  <td><%= inventory_item.quantity %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="ibox-footer text-center">
        <%= edit_button_to :edit_audit, {text: 'Resume Audit', size: 'sm'} if @audit.in_progress? %>
        <%= delete_button_to :audit, {text: 'Delete Audit', size: 'sm'} if @audit.in_progress? || @audit.confirmed? %>
        <%= submit_button_to audit_finalize_path(@audit.id), {text: 'Finalize Audit', size: 'sm'}, {data: {confirm: 'This will adjust the inventory permanently. Are you sure that you want to submit this?'}} if @audit.confirmed? %>
      </div>
    </div>
  </div>
</div>
